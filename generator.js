var okaySrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjIycHgiIGhlaWdodD0iNjRweCIgdmlld0JveD0iMCAwIDIyMiA2NCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTIuMiAoNjcxNDUpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPgogICAgPHRpdGxlPuWIhue7hDwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPgogICAgICAgIDxwb2x5Z29uIGlkPSJwYXRoLTEiIHBvaW50cz0iMC4wMDAzNSAwLjE1NiA2My44NDc2IDAuMTU2IDYzLjg0NzYgNjMuOTk5OSAwLjAwMDM1IDYzLjk5OTkiPjwvcG9seWdvbj4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLliIbnu4QiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLCAtMS4wMDAwMDApIj4KICAgICAgICAgICAgPHBhdGggZD0iTTExMS4yNzE3LDIuNTk0NyBMOTYuOTYxNywyLjU5NDcgTDY4LjM0NjcsMzEuMjI0NyBDNjcuNDA5NywzMi4xNjE3IDY3LjQwOTcsMzMuNjgyNyA2OC4zNDY3LDM0LjYxOTcgTDk2Ljk2MTcsNjMuMjQ5NyBMMTExLjI3MTcsNjMuMjQ5NyBMODAuOTU5NywzMi45MjE3IEwxMTEuMjcxNywyLjU5NDcgWiIgaWQ9IkZpbGwtMSIgZmlsbD0iIzIzMTkxNiI+PC9wYXRoPgogICAgICAgICAgICA8cGF0aCBkPSJNMTM0LjUwMjcsMzguNjA3NCBMMTQyLjg5MjcsMTUuNTQ3NCBMMTUxLjI4MTcsMzguNjA3NCBMMTM0LjUwMjcsMzguNjA3NCBaIE0xNjAuMjQ3Nyw2My4yNTA0IEwxNzEuMDExNyw2My4yNTA0IEwxNDkuNTE5Nyw0LjE3NTQgQzE0OS4xNzQ3LDMuMjI2NCAxNDguMjcyNywyLjU5NDQgMTQ3LjI2MjcsMi41OTQ0IEwxMzguNTIyNywyLjU5NDQgQzEzNy41MTI3LDIuNTk0NCAxMzYuNjEwNywzLjIyNjQgMTM2LjI2NTcsNC4xNzU0IEwxMTQuNzcyNyw2My4yNTA0IEwxMjUuNTM3Nyw2My4yNTA0IEwxMzEuMTkyNyw0Ny43MDQ0IEwxNTQuNTkxNyw0Ny43MDQ0IEwxNjAuMjQ3Nyw2My4yNTA0IFoiIGlkPSJGaWxsLTMiIGZpbGw9IiMyMzE5MTYiPjwvcGF0aD4KICAgICAgICAgICAgPHBvbHlnb24gaWQ9IkZpbGwtNSIgZmlsbD0iIzIzMTkxNiIgcG9pbnRzPSIyMjIuMDU5MyAyLjU5NDcgMjA5LjcyMTMgMi41OTQ3IDE5Mi4wMjczIDI3Ljg2NDcgMTc0LjMzMTMgMi41OTQ3IDE2MS45OTQzIDIuNTk0NyAxODYuOTczMyAzOC4yNjg3IDE4Ni45NzMzIDYzLjIzODcgMTk3LjA4MDMgNjMuMjM4NyAxOTcuMDgwMyAzOC4yNjg3Ij48L3BvbHlnb24+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLCAwLjg0NDQwMCkiPgogICAgICAgICAgICAgICAgPG1hc2sgaWQ9Im1hc2stMiIgZmlsbD0id2hpdGUiPgogICAgICAgICAgICAgICAgICAgIDx1c2UgeGxpbms6aHJlZj0iI3BhdGgtMSI+PC91c2U+CiAgICAgICAgICAgICAgICA8L21hc2s+CiAgICAgICAgICAgICAgICA8ZyBpZD0iQ2xpcC04Ij48L2c+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNDkuMjc1Niw0OS40NzM5IEM0Ni4xOTQ2LDUyLjU2MTkgMzkuMDU2Niw1NC4xMDU5IDMxLjkxNzYsNTQuMTA1OSBDMjQuNzc3Niw1NC4xMDU5IDE3LjYzODYsNTIuNTYxOSAxNC41NTM2LDQ5LjQ3MzkgQzguMzkyNiw0My4yOTM5IDguMzk1NiwyMC44NjY5IDE0LjU1ODYsMTQuNjkzOSBDMTcuOTc2NiwxMS4yNjk5IDI1Ljc2NjYsMTAuMDQ5OSAzMS45MTc2LDEwLjA0OTkgQzM4LjA2ODYsMTAuMDQ5OSA0NS44NTg2LDExLjI2OTkgNDkuMjc1NiwxNC42OTM5IEM1Mi42OTU2LDE4LjExNDkgNTMuOTEzNiwyNS45MTk5IDUzLjkxMzYsMzIuMDgxOSBDNTMuOTEyNiwzOC4yNDQ5IDUyLjY5MzYsNDYuMDQ4OSA0OS4yNzU2LDQ5LjQ3MzkgTTMxLjkyNTYsMC4xNTU5IEMyMC40Nzg2LDAuMTU1OSAxMC44MTc2LDIuNzA5OSA2LjcxMzYsNi44MjI5IEMtMi4yMzc0LDE1Ljc5MTkgLTIuMjM3NCw0OC4zNjY5IDYuNzEzNiw1Ny4zMzU5IEMxMC44MTU2LDYxLjQ0NjkgMjAuNDc0Niw2My45OTk5IDMxLjkyMTYsNjMuOTk5OSBDNDMuMzY5Niw2My45OTk5IDUzLjAzMDYsNjEuNDQ2OSA1Ny4xMzM2LDU3LjMzNTkgQzY2LjA4NTYsNDguMzY2OSA2Ni4wODU2LDE1Ljc5MTkgNTcuMTMzNiw2LjgyMjkgQzUzLjAzMTYsMi43MDk5IDQzLjM3MjYsMC4xNTU5IDMxLjkyNTYsMC4xNTU5IiBpZD0iRmlsbC03IiBmaWxsPSIjMjMxOTE2IiBtYXNrPSJ1cmwoI21hc2stMikiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+';
var lbSrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjIgKDY3MTQ1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT7lt6bkuIvop5I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8cGF0aCBkPSJNMTAsMSBMNCwxIEMyLjM0MzE0NTc1LDEgMSwyLjM0MzE0NTc1IDEsNCBMMSwxMCBMMCwxMCBMMCw0IEMwLDEuNzkwODYxIDEuNzkwODYxLDAgNCwwIEwxMCwwIEwxMCwxIFogTTEyLDMgTDYsMyBDNC4zNDMxNDU3NSwzIDMsNC4zNDMxNDU3NSAzLDYgTDMsMTIgTDIsMTIgTDIsNiBDMiwzLjc5MDg2MSAzLjc5MDg2MSwyIDYsMiBMMTIsMiBMMTIsMyBaIiBpZD0i5bem5LiL6KeSIiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYuMDAwMDAwLCA2LjAwMDAwMCkgc2NhbGUoMSwgLTEpIHRyYW5zbGF0ZSgtNi4wMDAwMDAsIC02LjAwMDAwMCkgIj48L3BhdGg+CiAgICA8L2c+Cjwvc3ZnPg==';
var rtSrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjIgKDY3MTQ1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT7lj7PkuIrop5I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8cGF0aCBkPSJNMTAsMSBMNCwxIEMyLjM0MzE0NTc1LDEgMSwyLjM0MzE0NTc1IDEsNCBMMSwxMCBMMCwxMCBMMCw0IEMwLDEuNzkwODYxIDEuNzkwODYxLDAgNCwwIEwxMCwwIEwxMCwxIFogTTEyLDMgTDYsMyBDNC4zNDMxNDU3NSwzIDMsNC4zNDMxNDU3NSAzLDYgTDMsMTIgTDIsMTIgTDIsNiBDMiwzLjc5MDg2MSAzLjc5MDg2MSwyIDYsMiBMMTIsMiBMMTIsMyBaIiBpZD0i5Y+z5LiK6KeSIiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYuMDAwMDAwLCA2LjAwMDAwMCkgc2NhbGUoLTEsIDEpIHRyYW5zbGF0ZSgtNi4wMDAwMDAsIC02LjAwMDAwMCkgIj48L3BhdGg+CiAgICA8L2c+Cjwvc3ZnPg==';
var ltSrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjIgKDY3MTQ1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT7lt6bkuIrop5I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8cGF0aCBkPSJNMTAsMSBMNCwxIEMyLjM0MzE0NTc1LDEgMSwyLjM0MzE0NTc1IDEsNCBMMSwxMCBMMCwxMCBMMCw0IEMwLDEuNzkwODYxIDEuNzkwODYxLDAgNCwwIEwxMCwwIEwxMCwxIFogTTEyLDMgTDYsMyBDNC4zNDMxNDU3NSwzIDMsNC4zNDMxNDU3NSAzLDYgTDMsMTIgTDIsMTIgTDIsNiBDMiwzLjc5MDg2MSAzLjc5MDg2MSwyIDYsMiBMMTIsMiBMMTIsMyBaIiBpZD0i5bem5LiK6KeSIiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iPjwvcGF0aD4KICAgIDwvZz4KPC9zdmc+';
var rbSrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjIgKDY3MTQ1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT7lj7PkuIvop5I8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8cGF0aCBkPSJNMTAsMSBMNCwxIEMyLjM0MzE0NTc1LDEgMSwyLjM0MzE0NTc1IDEsNCBMMSwxMCBMMCwxMCBMMCw0IEMwLDEuNzkwODYxIDEuNzkwODYxLDAgNCwwIEwxMCwwIEwxMCwxIFogTTEyLDMgTDYsMyBDNC4zNDMxNDU3NSwzIDMsNC4zNDMxNDU3NSAzLDYgTDMsMTIgTDIsMTIgTDIsNiBDMiwzLjc5MDg2MSAzLjc5MDg2MSwyIDYsMiBMMTIsMiBMMTIsMyBaIiBpZD0i5Y+z5LiL6KeSIiBmaWxsPSIjMDAwMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYuMDAwMDAwLCA2LjAwMDAwMCkgc2NhbGUoLTEsIC0xKSB0cmFuc2xhdGUoLTYuMDAwMDAwLCAtNi4wMDAwMDApICI+PC9wYXRoPgogICAgPC9nPgo8L3N2Zz4=';
var descSrc = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjEwcHgiIGhlaWdodD0iMTMwcHgiIHZpZXdCb3g9IjAgMCAyMTAgMTMwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA1Mi4yICg2NzE0NSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+5rOo5oSP5LqL6aG5PC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGRlZnM+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMSIgcG9pbnRzPSIwIDAgMTMgMCAxMyAxMSAwIDExIj48L3BvbHlnb24+CiAgICAgICAgPHBvbHlnb24gaWQ9InBhdGgtMyIgcG9pbnRzPSIwLjA1OTc3NDUwOTggMC4wODkwNjE0MDM1IDkuOTc1MzYyNzUgMC4wODkwNjE0MDM1IDkuOTc1MzYyNzUgMTAuOTU3MDEzMiAwLjA1OTc3NDUwOTggMTAuOTU3MDEzMiI+PC9wb2x5Z29uPgogICAgICAgIDxwb2x5Z29uIGlkPSJwYXRoLTUiIHBvaW50cz0iMC4wMzU4NjQ3MDU5IDAuMDU2Njc1NDM4NiA1Ljk4NTIxNzY1IDAuMDU2Njc1NDM4NiA1Ljk4NTIxNzY1IDYuOTcyNjQ0NzQgMC4wMzU4NjQ3MDU5IDYuOTcyNjQ0NzQiPjwvcG9seWdvbj4KICAgICAgICA8cG9seWdvbiBpZD0icGF0aC03IiBwb2ludHM9IjAgMCA5IDAgOSAxMCAwIDEwIj48L3BvbHlnb24+CiAgICA8L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0i5rOo5oSP5LqL6aG5Ij4KICAgICAgICAgICAgPGcgaWQ9IuWIhue7hC0yIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg3Mi4wMDAwMDAsIDEyLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9IuW3puS4iyIgZmlsbD0iIzAwMDAwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMi4wMDAwMDAsIDEyLjAwMDAwMCkgcm90YXRlKC0xODAuMDAwMDAwKSB0cmFuc2xhdGUoLTIuMDAwMDAwLCAtMTIuMDAwMDAwKSAiIHBvaW50cz0iMy41OTYxOTQwOCAxNCAwIDEwLjQwMzgwNTkgMCAxMCA0IDEwIDQgMTQiPjwvcG9seWdvbj4KICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSLlt6bkuIstY29weSIgZmlsbD0iIzAwMDAwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzEuMDAwMDAwLCAyLjAwMDAwMCkgcm90YXRlKC0zNjAuMDAwMDAwKSB0cmFuc2xhdGUoLTcxLjAwMDAwMCwgLTIuMDAwMDAwKSAiIHBvaW50cz0iNzIuNTk2MTk0MSA0IDY5IDAuNDAzODA1OTIyIDY5IDAgNzMgMCA3MyA0Ij48L3BvbHlnb24+CiAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMC41LDAuNSBMMC41LDEzLjUgTDcyLjUsMTMuNSBMNzIuNSwwLjUgTDAuNSwwLjUgWiIgaWQ9IuefqeW9oiIgc3Ryb2tlPSIjMDAwMDAwIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8dGV4dCBpZD0iW0FdIiBmb250LWZhbWlseT0iSGVsdmV0aWNhTmV1ZSwgSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iOCIgZm9udC13ZWlnaHQ9Im5vcm1hbCIgZmlsbD0iIzgzOTA5NiI+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHg9IjUiIHk9IjkiPltBXTwvdHNwYW4+CiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgICAgICA8dGV4dCBpZD0iW0JdIiBmb250LWZhbWlseT0iSGVsdmV0aWNhTmV1ZSwgSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iOCIgZm9udC13ZWlnaHQ9Im5vcm1hbCIgZmlsbD0iIzgzOTA5NiI+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHg9IjIzIiB5PSI5Ij5bQl08L3RzcGFuPgogICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICAgICAgPHRleHQgaWQ9IltDXSIgZm9udC1mYW1pbHk9IkhlbHZldGljYU5ldWUsIEhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjgiIGZvbnQtd2VpZ2h0PSJub3JtYWwiIGZpbGw9IiM4MzkwOTYiPgogICAgICAgICAgICAgICAgICAgIDx0c3BhbiB4PSI0MSIgeT0iOSI+W0NdPC90c3Bhbj4KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgICAgIDx0ZXh0IGlkPSJbRF0iIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2FOZXVlLCBIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSI4IiBmb250LXdlaWdodD0ibm9ybWFsIiBmaWxsPSIjODM5MDk2Ij4KICAgICAgICAgICAgICAgICAgICA8dHNwYW4geD0iNTkiIHk9IjkiPltEXTwvdHNwYW4+CiAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPGcgaWQ9IuWIhue7hC0zIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMi4wMDAwMDAsIDMxLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9IuWIhue7hC0yLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYwLjAwMDAwMCwgMS4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8cG9seWdvbiBpZD0i5bem5LiLIiBmaWxsPSIjMDAwMDAwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjAwMDAwMCwgMTIuMDAwMDAwKSByb3RhdGUoLTE4MC4wMDAwMDApIHRyYW5zbGF0ZSgtMi4wMDAwMDAsIC0xMi4wMDAwMDApICIgcG9pbnRzPSIzLjU5NjE5NDA4IDE0IDAgMTAuNDAzODA1OSAwIDEwIDQgMTAgNCAxNCI+PC9wb2x5Z29uPgogICAgICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSLlt6bkuIstY29weSIgZmlsbD0iIzAwMDAwMCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzEuMDAwMDAwLCAyLjAwMDAwMCkgcm90YXRlKC0zNjAuMDAwMDAwKSB0cmFuc2xhdGUoLTcxLjAwMDAwMCwgLTIuMDAwMDAwKSAiIHBvaW50cz0iNzIuNTk2MTk0MSA0IDY5IDAuNDAzODA1OTIyIDY5IDAgNzMgMCA3MyA0Ij48L3BvbHlnb24+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTAuNSwwLjUgTDAuNSwxMy41IEw3Mi41LDEzLjUgTDcyLjUsMC41IEwwLjUsMC41IFoiIGlkPSLnn6nlvaIiIHN0cm9rZT0iIzAwMDAwMCI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDx0ZXh0IGlkPSJbQV0iIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2FOZXVlLCBIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSI4IiBmb250LXdlaWdodD0ibm9ybWFsIiBmaWxsPSIjODM5MDk2Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHg9IjUiIHk9IjkiPltBXTwvdHNwYW4+CiAgICAgICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICAgICAgICAgIDx0ZXh0IGlkPSJbQl0iIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2FOZXVlLCBIZWx2ZXRpY2EgTmV1ZSIgZm9udC1zaXplPSI4IiBmb250LXdlaWdodD0ibm9ybWFsIiBmaWxsPSIjODM5MDk2Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHRzcGFuIHg9IjIzIiB5PSI5Ij5bQl08L3RzcGFuPgogICAgICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgICAgICAgICA8dGV4dCBpZD0iW0NdIiBmb250LWZhbWlseT0iSGVsdmV0aWNhTmV1ZSwgSGVsdmV0aWNhIE5ldWUiIGZvbnQtc2l6ZT0iOCIgZm9udC13ZWlnaHQ9Im5vcm1hbCIgZmlsbD0iIzgzOTA5NiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0c3BhbiB4PSI0MSIgeT0iOSI+W0NdPC90c3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L3RleHQ+CiAgICAgICAgICAgICAgICAgICAgPHRleHQgaWQ9IltEXSIgZm9udC1mYW1pbHk9IkhlbHZldGljYU5ldWUsIEhlbHZldGljYSBOZXVlIiBmb250LXNpemU9IjgiIGZvbnQtd2VpZ2h0PSJub3JtYWwiIGZpbGw9IiM4MzkwOTYiPgogICAgICAgICAgICAgICAgICAgICAgICA8dHNwYW4geD0iNTkiIHk9IjkiPltEXTwvdHNwYW4+CiAgICAgICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPHRleHQgaWQ9IumUmeivr+Whq+a2gu+8miIgZm9udC1mYW1pbHk9Ik1pY3Jvc29mdFlhSGVpLCBNaWNyb3NvZnQgWWFIZWkiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtd2VpZ2h0PSJub3JtYWwiIGZpbGw9IiMwMDAwMDAiPgogICAgICAgICAgICAgICAgICAgIDx0c3BhbiB4PSIwIiB5PSIxMyI+6ZSZ6K+v5aGr5raC77yaPC90c3Bhbj4KICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgICAgIDxnIGlkPSLliIbnu4QiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY0LjAwMDAwMCwgMy4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8bWFzayBpZD0ibWFzay0yIiBmaWxsPSJ3aGl0ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx1c2UgeGxpbms6aHJlZj0iI3BhdGgtMSI+PC91c2U+CiAgICAgICAgICAgICAgICAgICAgPC9tYXNrPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSJDbGlwLTIiPjwvZz4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMCw1LjY2NDEzOTg5IEwxLjM2ODQwMDk1LDQuNTE0OTI4ODMgTDQuNTA3NjY0NzQsNi45MzY2MTA0MiBDNC41MDc2NjQ3NCw2LjkzNjYxMDQyIDguMDg5Nzk3LDIuNzkxMDczNjEgMTIuNDc2Nzc2NiwwIEwxMywwLjY1NjcxNDExMSBDMTMsMC42NTY3MTQxMTEgOC4wMDkyMTI5Niw1LjEzMDYwNzk3IDUuNDMzNDI2MzYsMTEgTDAsNS42NjQxMzk4OSBaIiBpZD0iRmlsbC0xIiBmaWxsPSIjODg4QzkzIiBtYXNrPSJ1cmwoI21hc2stMikiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxnIGlkPSLliIbnu4QiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgyLjAwMDAwMCwgMi4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjAwMDAwMCwgMC4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICAgICAgPG1hc2sgaWQ9Im1hc2stNCIgZmlsbD0id2hpdGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC0zIj48L3VzZT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9tYXNrPgogICAgICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iQ2xpcC0yIj48L2c+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0yLjY1MzEwNzg0LDEwLjk1NzAxMzIgQzMuNDc3MzIzNTMsOC44MzUzNjQwNCA5Ljk3NTM2Mjc1LDIuOTg2MjU4NzcgOS45NzUzNjI3NSwyLjk4NTM5MDM1IEM4Ljc4MDU1ODgyLDEuODI2ODIwMTggOC41OTYxNDcwNiwwLjA4OTAxMzE1NzkgOC41OTYxNDcwNiwwLjA4OTAxMzE1NzkgQzUuMzM2NTM5MjIsNC41MDUyMjM2OCAwLjA1OTc3NDUwOTgsOC45NDczOTAzNSAwLjA1OTc3NDUwOTgsOC45NDczOTAzNSBDMS4yODQ1Nzg0Myw5LjI2MjUzMDcgMi42NTMxMDc4NCwxMC45NTcwMTMyIDIuNjUzMTA3ODQsMTAuOTU3MDEzMiIgaWQ9IkZpbGwtMSIgZmlsbD0iIzg3OEI5MiIgbWFzaz0idXJsKCNtYXNrLTQpIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMSw4LjY0NjEwNzMgQzguODUyNTgxODYsNy44OTgwNzk4NSAyLjkzMjMzNzE3LDIgMi45MzE1NTU4NiwyIEMxLjc1ODkxMzk5LDMuMDg0NDg4NTIgMCwzLjI1MTg3MzY4IDAsMy4yNTE4NzM2OCBDNC40Njk4NDg3MSw2LjIxMDQzNTI1IDguOTY1ODcxMTYsMTEgOC45NjU4NzExNiwxMSBDOS4yODUwMzQ0NSw5Ljg4ODI4MTM2IDExLDguNjQ2MTA3MyAxMSw4LjY0NjEwNzMiIGlkPSJGaWxsLTMiIGZpbGw9IiM4NzhCOTIiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxnIGlkPSLliIbnu4QtY29weSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTIzLjAwMDAwMCwgNi4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0i5YiG57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjAwMDAwMCwgMC4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICAgICAgPG1hc2sgaWQ9Im1hc2stNiIgZmlsbD0id2hpdGUiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVzZSB4bGluazpocmVmPSIjcGF0aC01Ij48L3VzZT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9tYXNrPgogICAgICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iQ2xpcC0yIj48L2c+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xLjU5MTg2NDcxLDYuOTcyNjQ0NzQgQzIuMDg2Mzk0MTIsNS42MjI1MDQzOSA1Ljk4NTIxNzY1LDEuOTAwMzQ2NDkgNS45ODUyMTc2NSwxLjg5OTc5Mzg2IEM1LjI2ODMzNTI5LDEuMTYyNTIxOTMgNS4xNTc2ODgyNCwwLjA1NjY0NDczNjggNS4xNTc2ODgyNCwwLjA1NjY0NDczNjggQzMuMjAxOTIzNTMsMi44NjY5NjA1MyAwLjAzNTg2NDcwNTksNS42OTM3OTM4NiAwLjAzNTg2NDcwNTksNS42OTM3OTM4NiBDMC43NzA3NDcwNTksNS44OTQzMzc3MiAxLjU5MTg2NDcxLDYuOTcyNjQ0NzQgMS41OTE4NjQ3MSw2Ljk3MjY0NDc0IiBpZD0iRmlsbC0xIiBmaWxsPSIjODc4QjkyIiBtYXNrPSJ1cmwoI21hc2stNikiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcsNS40MzA3MzgyIEM1LjYzMzQ2MTE4LDQuOTMyMDUzMjMgMS44NjYwMzI3NCwxIDEuODY1NTM1NTUsMSBDMS4xMTkzMDg5LDEuNzIyOTkyMzUgMCwxLjgzNDU4MjQ1IDAsMS44MzQ1ODI0NSBDMi44NDQ0NDkxOCwzLjgwNjk1NjgzIDUuNzA1NTU0MzcsNyA1LjcwNTU1NDM3LDcgQzUuOTA4NjU4MjksNi4yNTg4NTQyNCA3LDUuNDMwNzM4MiA3LDUuNDMwNzM4MiIgaWQ9IkZpbGwtMyIgZmlsbD0iIzg3OEI5MiI+PC9wYXRoPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgPGcgaWQ9IuWIhue7hCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAxLjAwMDAwMCwgMy4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8bWFzayBpZD0ibWFzay04IiBmaWxsPSJ3aGl0ZSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDx1c2UgeGxpbms6aHJlZj0iI3BhdGgtNyI+PC91c2U+CiAgICAgICAgICAgICAgICAgICAgPC9tYXNrPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSJDbGlwLTIiPjwvZz4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNS4wNDA5NDUxMiwwLjE1OTc2OTg1NCBMNS4wNDA5NDUxMiwzLjc1MDc5NTI5IEw4LjgyNzQ4MjMxLDMuNzUwNzk1MjkgQzguOTcxNTk0NCwzLjc1MDc5NTI5IDkuMDQzOTY5OTgsMy45MDY3NzQ1IDguOTcxNTk0NCw0LjAwMDUzMDIgTDQuMjgzOTU3MjIsOS45MzMzNDU5NSBDNC4yMzg3NDI0NSw5Ljk4OTgyMzYgNC4xNTY3ODA2OSwxMC4wMTM2NDc5IDQuMDgyMDA4NTcsOS45OTIyMDYwMyBDNC4wMDcyMzY0NCw5Ljk3MDQ4Mzg2IDMuOTU3Mzg4MzUsOS45MDg1NDA2MyAzLjk1OTMwNTU5LDkuODM5NTkwMjUgTDMuOTU5MzA1NTksNi4yNDg1NjQ4MiBMMC4xNzI0NDg4NTUsNi4yNDg1NjQ4MiBDMC4wMjgzMzY3NjQ1LDYuMjQ4NTY0ODIgLTAuMDQzODc5MDUwMyw2LjA5MjQ0NTQ2IDAuMDI4MzM2NzY0NSw1Ljk5ODY4OTc3IEw0LjcxNTk3Mzk1LDAuMDY2NTc0NzI3OSBDNC43NjExODg3MiwwLjAxMDIzNzIyMyA0Ljg0MzE1MDQ3LC0wLjAxMzcyNzIzODEgNC45MTc3NjI4MywwLjAwNzg1NDc5MTE5IEM0Ljk5MjM3NTE5LDAuMDI5Mjk2Njc3NCA1LjA0MjM4MzA0LDAuMDkxMDk5NzYxMSA1LjA0MDYyNTU4LDAuMTYwMDUwMTQiIGlkPSJGaWxsLTEiIGZpbGw9IiM4OThEOTQiIG1hc2s9InVybCgjbWFzay04KSI+PC9wYXRoPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0wLjUsMC41IEwwLjUsMTI5LjUgTDIwOS41LDEyOS41IEwyMDkuNSwwLjUgTDAuNSwwLjUgWiIgaWQ9IuefqeW9oiIgc3Ryb2tlPSIjOTc5Nzk3Ij48L3BhdGg+CiAgICAgICAgICAgIDx0ZXh0IGlkPSLmraPnoa7loavmtoLvvJoiIGZvbnQtZmFtaWx5PSJNaWNyb3NvZnRZYUhlaSwgTWljcm9zb2Z0IFlhSGVpIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0ibm9ybWFsIiBmaWxsPSIjMDAwMDAwIj4KICAgICAgICAgICAgICAgIDx0c3BhbiB4PSIxMiIgeT0iMjMiPuato+ehruWhq+a2gu+8mjwvdHNwYW4+CiAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgPGltYWdlIGlkPSJ0dXR1IiB4PSI5MiIgeT0iMTUiIHdpZHRoPSIxNiIgaGVpZ2h0PSI4IiB4bGluazpocmVmPSJkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUJBQUFBQUlDQVlBQUFEd2RuK1hBQUFBQVhOU1IwSUFyczRjNlFBQUFQVkpSRUZVS0JWZDBUOXFBa0VVeC9GWk1RcGFKQ2hDTElTSVNXTmpxWGdHS3c5aEVSUXNMTHhCRUR0THdSTjRBUzhneE1iQ1JpeXM3Q1JONGg4U2crTDN0OHdzeXo3NDhON003TDZabmZVK2hpTVRpZ3AxQTJzY1VNQVdDWHhqaFg5Y1lmcTlqb21yc0pFbnovRHNKaUpaRGZZWVlPTFdZcTRnbitDRnh0SHlrWWszdEZGMGkrRUdaU1l6ZHVGRzFqSGRjVFZXYUJNMW1hSU9FMjVRWmZ5QVB4eHRKZ1ZOTHRScGJQQ09CWUlHdXJ5dUpvaWtwZWJhK1JkNldVMFZaK2d5L1l2VVEwMjA4QUtGRm5Uck9vM3VKR1hIK3J3ZjFEQkdGdjVmV0pMMTBoYytVY0lPK3Q1WDVLQTFuVUFiUG1FTy9SVnpCd0V6TTViTjRVUnlBQUFBQUVsRlRrU3VRbUNDIj48L2ltYWdlPgogICAgICAgICAgICA8dGV4dCBpZD0i5rOo5oSP5LqL6aG577ya5omL5YaZ6YOo5YiG6K+355So6ZKi56yU5oiW5ZyG54+g56yU5aGr5YaZ77ybIiBmb250LWZhbWlseT0iTWljcm9zb2Z0WWFIZWksIE1pY3Jvc29mdCBZYUhlaSIgZm9udC1zaXplPSIxMiIgZm9udC13ZWlnaHQ9Im5vcm1hbCIgZmlsbD0iIzAwMDAwMCI+CiAgICAgICAgICAgICAgICA8dHNwYW4geD0iMTIiIHk9IjY1Ij7ms6jmhI/kuovpobnvvJrmiYvlhpnpg6jliIbor7fnlKjpkqLnrJTmiJblnIY8L3RzcGFuPgogICAgICAgICAgICAgICAgPHRzcGFuIHg9IjEyIiB5PSI4MSI+54+g56yU5aGr5YaZ77yb5aGr5raC6YOo5YiG6K+355SoMkLpk4XnrJTov5s8L3RzcGFuPgogICAgICAgICAgICAgICAgPHRzcGFuIHg9IjEyIiB5PSI5NyI+6KGM5raC5oq577yM5L+u5pS56K+355So5qmh55qu5pOm5bmy5YeA44CCPC90c3Bhbj4KICAgICAgICAgICAgICAgIDx0c3BhbiB4PSIxMiIgeT0iMTEzIj7or7TmmI464oCcVOKAneihqOekuuato+ehrizigJxG4oCd6KGo56S66ZSZ6K+vPC90c3Bhbj4KICAgICAgICAgICAgPC90ZXh0PgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+';

console.log(util.toPx('210mm'));
console.log(util.toPx('297mm'));
var pageWidth = util.toPx('210mm');
//hack 如果不减1会多生成1个空白页面；每页都会有1px偏差，偏差累加页数多了有bug
var pageHeight = util.toPx('297mm') - 1;

//两边间距
var pageMargin = 54*2;
//内容区宽度
var contentWidth = pageWidth - pageMargin;
//header的高度
var headerHeight = 178;
//footer的高度
var footerHeight = 50;
//内容区高度
var bodyHeight = pageHeight - headerHeight - footerHeight;
//题型文字行高
var typeLineHeight = 40;

/*
** data 答题卡的数据
** dtd 延迟对象
** downloadType 下载类型 1.直接下载 2.zip下载
*/
function AnswerSheet(data,dtd,downloadType){
    this.data = data;
    this.dtd = dtd;
    this.downloadType = downloadType;
    this.element = document.createElement('div');
    this.element.style.width = pageWidth + 'px';
    document.body.appendChild(this.element);
    this.currentPage = 1;
    //累计高度，用来计算分页
    this.accHeight = 0;
    //每页的HTML
    this.htmlPerPage = '';
    //题目的索引，自己手工累加
    this.tiIndex = 0;
    //复合题小题index
    this.subIndex = 0;
    //题目类型 聚合的数据有用
    this.tiType = '';
    this.subTiType = '';
    this.questionList = data.question_info;
    this.sortType = data.sort_type;;
    this.groupIndex = 0;
    this.qrcodeDataList = [{
        pid: this.data.taskId, //任务ID
        lid: this.data.id, // 题集ID
        pn: this.currentPage, // 当期页码
        pc: 1, // 总页数   // TODO
        qc: 1, // 当前页题数量 // TODO
        qlist: []
    }];
}

AnswerSheet.prototype.init = function(){
    this.generatePageHTML(this.data);
    this.renderPage();
}

//生成每页的HTML
AnswerSheet.prototype.generatePageHTML = function(data){
    var tmpl = `<div class="page-wrap" style="height: ${pageHeight}px">
                    <div class="cr-page-header">
                        <img src="${okaySrc}" class="logo">
                        <img src="${okaySrc}" class="logo">
                        <div class="dtk-tip">
                            ${util.hasAudio(data.question_info) ? '<p>【音频请到学生空间 http://student.okjiaoyu.cn 获取】</p>' : ''}
                            <p>【作答完毕后请使用『OKAY+』APP墨镜-拍照功能扫描全部答题卡】</p>
                        </div>
                        <div class="dtk-info-wrapper clearfix">
                            <div class="qrcode fl"></div>
                            <div class="dtk-title">
                                <p class="dtk-task-name">${data.taskName}</p>
                                <p class="dtk-name">${data.name}</p>
                                <p class="dtk-task-time">${data.taskTypeName} ${data.taskTimeInfo}</p>
                            </div>
                            <img class="dtk-description"  src=${descSrc} />
                            <div>

                            </div>
                        </div>
                    </div>
                    <div class="cr-page-body"></div>
                    <div class="cr-page-footer">
                        <div class="clearfix">
                            <img src="${okaySrc}" alt="" class="fl logo">
                            <img src="${okaySrc}" alt="" class="fr logo">
                            <p>第${this.currentPage}页 （共<span class="total-page"></span>页）</p>
                        </div>
                    </div>
                </div>`;

    this.element.insertAdjacentHTML('beforeend',tmpl);
}

//根据题型遍历
AnswerSheet.prototype.walk = function(item, isSub){
    if(!Array.isArray(item)){
        item = [item];
    }
    switch (~~item[0].struct_id) {
        case 1:
            this.generateChoiceHTML(item, isSub); break;
        case 2:
            this.generateJudgeHTML(item, isSub); break;
        case 3:
            item.forEach((child) => {
                this.generateShortHTML(child, isSub);
            });
            break;
        case 4:
            this.generateBlankHTML(item, isSub); break;
        case 9:
            item.forEach((child) => {
                this.generate5in7HTML(child, isSub);
            });
            break;
        case 5:
        case 6:
        case 7:
            item.forEach((child) => {
                this.generateGroupHTML(child, isSub);
            });
            break
    }
}

//渲染每页
AnswerSheet.prototype.renderPage = function(){
    var item,tempArr = [];
    //1 聚合；2 乱序
    var sortType = this.data.sort_type;
    var questionList = this.data.question_info;
    var tiType = this.data.question_info[0].type_id;
    for(var i = 0,len = this.data.question_info.length ; i < len; i++ ){
        item = this.data.question_info[i];

        if(sortType == 1){
            if(i == 0){
                this.generateTitleHTML(item.type_name,true);
            }
            if(tiType == item.type_id){
                tempArr.push(item);
            }else{
                this.walk(tempArr, false);
                this.groupIndex++;
                this.generateTitleHTML(item.type_name,true);
                tiType = item.type_id;
                tempArr.length = 0;
                tempArr.push(item);
            }
        }else{
            if(util.isSingle(item) ){
                this.generateTitleHTML(item.type_name);
            }
            this.walk(item, false);
        }

        if(i == len - 1){
            if(sortType == 1){
                this.walk(tempArr, false);
            }
            this.element.querySelectorAll('.cr-page-body')[this.currentPage - 1].innerHTML = this.htmlPerPage;
        }
    }

    console.log('this.qrcodeDataList',this.qrcodeDataList);
    this.element.querySelectorAll('.total-page').forEach((node) => {node.innerText = this.currentPage});
    this.qrcodeDataList.forEach((qrcode, index) =>{
        qrcode.pc = this.currentPage;
        qrcode.qc = qrcode.qlist.length;
    });
    var params = {
        pageArr: JSON.stringify(this.qrcodeDataList)
    }
    setTimeout(() => {
        this.qrcodeDataList.forEach((qrcode, index) => {
            this.element.querySelectorAll('.qrcode')[index].innerHTML = new QRCode({
                content: 'https://jz.okay.cn?auto=1&ocr=' + index,
                width: 100,
                height: 100,
                padding: 0,
                color: "#000000",
                background: "#ffffff",
                ecl: "M"
            }).svg();
        });
        this.download();
    })
}

//判断是否需要分页
AnswerSheet.prototype.checkPagination = function(){
    if(this.accHeight > bodyHeight){
        return true;
    }
    return false;
}

//是否需要换页
AnswerSheet.prototype.checkPageBreak = function(h,isSub,str){
    this.accHeight += h;
    if(this.checkPagination()){
        if(str){
            this.htmlPerPage += str;
        }
        this.appendPage();
        this.accHeight = h;
        if(isSub){
            this.generateTitleHTML(this.tiIndex + '.' + this.questionList[this.tiIndex - 1].type_name);
            if(this.subIndex == 0){
                //复合题换页需要题号和题目名称，重新添加一个且把上一页的最后一个删除掉
                var nodeList = this.element.querySelectorAll('.cr-page-body')[this.currentPage - 2].querySelectorAll('h2');
                var lastH2 = nodeList[nodeList.length - 1];
                if(lastH2){
                    lastH2.parentNode.removeChild(lastH2);
                }
            }
        }
        return true;
    }
    return false;
}

//新加一页
AnswerSheet.prototype.appendPage = function(){
    // this.storeQrcodeData();
    this.element.querySelectorAll('.cr-page-body')[this.currentPage - 1].innerHTML = this.htmlPerPage;
    this.accHeight = 0;
    this.currentPage++;
    this.htmlPerPage = '';
    this.generatePageHTML(this.data);
    this.qrcodeDataList.push({
        pid: this.data.taskId, //任务ID
        lid: this.data.id, // 题集ID
        pn: this.currentPage, // 当期页码
        pc: 1, // 总页数   // TODO
        qc: this.currentPage, // 当前页题数量 // TODO
        qlist: []
    })
}

//生成题型THML
AnswerSheet.prototype.generateTitleHTML = function(typeName,isGroup){
    this.accHeight += typeLineHeight;
    if(this.checkPagination()){;
        this.appendPage();
        this.accHeight = typeLineHeight;
    }
    this.htmlPerPage += '<h2>' + (isGroup ? util.generateChinseNo(this.groupIndex) + '、' : '') + typeName + '</h2>';
}

//生成复合题HTML
AnswerSheet.prototype.generateGroupHTML = function(data){
    var tempArr = [];
    this.tiIndex++;
    this.subTiType = data.children[0].type_id;
    this.generateTitleHTML(this.tiIndex + '.' + data.type_name);
    if(data.children.length == 1){
        this.walk(data.children[0], true);
    }else{
        for(var i = 0,len = data.children.length ; i < len; i++ ){
            var item = data.children[i];

            if(this.subTiType == item.type_id){
                tempArr.push(item);
            }else{
                this.walk(tempArr, true);
                this.subTiType = item.type_id;
                tempArr.length = 0;
                tempArr.push(item);
            }
        }
        this.walk(tempArr, true);
    }
    this.subIndex = 0;
}

//设置二维码需要的数据
AnswerSheet.prototype.setQrcodeData = function(isSub,x,y){
    var index = isSub ? this.tiIndex + '_' + this.subIndex : this.tiIndex;
    var item = this.questionList[this.tiIndex - 1];
    var offsetX = 54 - (6 + 17);
    var offsetY = 168 - 5;
    var offsetW = 36;
    var offsetH = 32;
    if(isSub){
    	item = item.children[this.subIndex - 1];
    }
    var data = {
        index: index,
        struct_id: item.struct_id == 9 ? 1 : item.struct_id,
        value: item.struct_id != 4 ? 1 : ([].concat(item.question_answer_list)).length,
        options: item.struct_id == 2 ? 2: item.option_list.length || 0,
        coordinate: {
            left_top: {x: x + offsetX,y: y + offsetY},
            right_bottom: {x: x + offsetX + offsetW, y: y + offsetY + offsetH}
        }
    }
    this.qrcodeDataList[this.currentPage - 1].qlist.push(data);
}

/**
** 生成单个选择题模板
** type pd-判断 xz-选择
** col 占几列
** no 题号
** optionLen 选项长度
**/
AnswerSheet.prototype.generateChoiceTemplate = function(type,col,no,optionLen){
    var str = '';
    str += '<li class="' + type + '-col-' + col + '">';
    str += '<span class="' + type + '-no">' + no + '</span>';
    str += '<span class="' + type + '-item-wrapper"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M100 100L0 0h100z" fill="#000" fill-rule="evenodd"/></svg><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M0 0l100 100H0z" fill="#000" fill-rule="evenodd"/></svg>';
    if(type == 'pd'){
        str += '<span class="clearfix text-item"><span class="fl">[</span>T<span class="fr">]</span></span><span class="clearfix text-item"><span class="fl">[</span>F<span class="fr">]</span></span>';
    }else{
        util.generateChoice(optionLen).forEach((item) => {
            str += '<span class="clearfix text-item"><span class="fl">[</span>' + item + '<span class="fr">]</span></span>';
        })
    }
    str += '</span></li>';
    return str;
}

//生成七选五HTML
AnswerSheet.prototype.generate5in7HTML = function(data,isSub){
    var str = '',no = '',height = this.get5in7Info(data).height;
    this.checkPageBreak(height,isSub);
    if(isSub){
        this.subIndex++;
    }else{
        this.tiIndex++;
    }
    for (var i = 0,len = data.question_answer_list.length; i < len; i++) {
        no = i == 0 ? (isSub ? '(' + this.subIndex + ')' : this.tiIndex + '.')  : '';
        str += this.generateChoiceTemplate('xz',Math.ceil(data.option_list.length / 4),no,data.option_list.length);
    }
    this.setQrcodeData(isSub,0,this.accHeight - height);
    str = '<ul class="col-wrapper clearfix">' + str + '</ul>';
    this.htmlPerPage += str;
}

//获取七选五的高度
AnswerSheet.prototype.get5in7Info = function(data){
    //每行高度
    var xzLineHeight = 40;
    //累计列数
    var accCol = 0;
    //总行数
    var lineCount = 1;
    //每题占的列数
    var colPerItem = 0;
    //选项的长度
    var len = data.option_list.length;
    //计算总行数
    data.question_answer_list.forEach((answer) => {
        colPerItem = Math.ceil(len / 4);
        accCol += colPerItem;
        if(accCol > 4){
            accCol = colPerItem;
            lineCount++;
        }
    });
    return {
        height: lineCount * xzLineHeight,
    };
}

//生成选择题HTML
AnswerSheet.prototype.generateChoiceHTML = function(data,isSub){
    if(!Array.isArray(data)){
        data = [data];
    }
    var str = '';
    //积累宽度的值
    var accCol = 0;
    //每题的宽度
    var colPerItem = 0;
    //每行高度 height + margin
    var xzLineHeight = 40;

    for (var i = 0,len = data.length; i < len; i++) {
        colPerItem = Math.ceil(data[i].option_list.length / 4);
        accCol += colPerItem;
        if(i == 0 || accCol > 4){
            accCol = colPerItem;
            if(this.checkPageBreak(xzLineHeight,isSub,str && '<ul class="col-wrapper clearfix">' + str + '</ul>')){
                str = '';
            }
        }
        if(isSub){
            this.subIndex++;
        }else{
            this.tiIndex++;
        }
        str += this.generateChoiceTemplate('xz',colPerItem,isSub ? '(' + this.subIndex + ')' : this.tiIndex + '.',data[i].option_list.length);
        this.setQrcodeData(isSub,(contentWidth * (accCol - colPerItem) / 4) >> 0,this.accHeight - xzLineHeight);
    }
    str = '<ul class="col-wrapper clearfix">' + str + '</ul>';
    this.htmlPerPage += str;
}

//生成填空题HTML
AnswerSheet.prototype.generateBlankHTML = function(data,isSub){
    if(!Array.isArray(data)){
        data = [data];
    }
    var str= '',lastLineCol = 0,arr = [];
    //先把每个题的信息存起来，不用多次获取
    for(var i = 0, len = data.length;i < len;i++){
        var blank = data[i];
        arr.push(this.getBlankInfo(blank));
    }

    /**
    *   获取每个题的info信息
    *   判断是否需要换页，需要换页就开始渲染当前页
    *   不需要换页遍历每个空，在最后一行判断下一题需不需要折行
    **/
    for(var i = 0, len = data.length;i < len;i++){
        var offset,item = data[i];
        var info = arr[i];
        if(i == 0 || i > 0 && lastLineCol + info.totalCol > 4){
            lastLineCol = 0;
            if(this.checkPageBreak(info.totalHeight,isSub,str && '<ul class="tiankong clearfix">' + str + '</ul>')){
                str = '';
            }
        }
        if(isSub){
            this.subIndex++;
        }else{
            this.tiIndex++;
        }
        for(var j=0,len1 = info.colPerBlank.length;j < len1;j++){
            lastLineCol += info.colPerBlank[j];
            if(lastLineCol > 4){
                lastLineCol = info.colPerBlank[j]
            }
            //折行判断逻辑 最后一个col不是最后一列；这个题的最后一行col和下个题的总col > 4
            offset = j == len1 - 1 && lastLineCol != 4 && arr[i + 1] && info.lastLineOffset + arr[i + 1].totalCol > 4 ? (' offset-' + (4 - info.lastLineOffset)) : '';
            if(offset){
                lastLineCol = 0;
            }
            str += '<li class="col-' + info.colPerBlank[j] + offset + '">';
            str += '<span class="blank-no">' + (j == 0 ? (isSub ? '(' + this.subIndex + ')' : this.tiIndex + '.') : '') + `</span><span class="slot"><svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M0 0l100 100H0z" fill="#000" fill-rule="evenodd"/></svg><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjEwMHB4IiBoZWlnaHQ9IjEwMHB4IiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjIgKDY3MTQ1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4NCiAgICA8dGl0bGU+VHJpYW5nbGUgQ29weTwvdGl0bGU+DQogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+DQogICAgPGcgaWQ9IlBhZ2UtMSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIxNC4wMDAwMDAsIC0xNzUuMDAwMDAwKSIgZmlsbD0iIzAwMDAwMCI+DQogICAgICAgICAgICA8cG9seWdvbiBpZD0iVHJpYW5nbGUtQ29weSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjY0LjAwMDAwMCwgMjI1LjAwMDAwMCkgc2NhbGUoLTEsIDEpIHRyYW5zbGF0ZSgtMjY0LjAwMDAwMCwgLTIyNS4wMDAwMDApICIgcG9pbnRzPSIyMTQgMTc1IDMxNCAyNzUgMjE0IDI3NSI+PC9wb2x5Z29uPg0KICAgICAgICA8L2c+DQogICAgPC9nPg0KPC9zdmc+" />
</span></li>`;
        }
        this.setQrcodeData(isSub,(contentWidth * Math.max(0,(lastLineCol - info.lastLineOffset)) / 4) >> 0,this.accHeight - info.totalHeight);
    }
    str = '<ul class="tiankong clearfix">' + str + '</ul>';
    this.htmlPerPage += str;
}

//获取填空题占的行数,总高度，每个填空占几列，最后一行的offset
AnswerSheet.prototype.getBlankInfo = function(data){
    var col;
    //每行4个
    var colomnPerLine = 4;
    //每行高度
    var tkLineHeight = 36;
    //累计列数
    var acc = 0;
    //偏移量
    var offset = 0;
    //总行数
    var lineCount = 1;
    //题目每个空占的列数
    var colPerBlank = [];
    //计算总行数
    data.question_answer_list.forEach((answer) => {
        col = util.getBlankCol(answer);
        colPerBlank.push(col);
        offset += col;
        acc += col;
        if(offset > colomnPerLine){
            offset = col;
            lineCount++;
        }
    });
    return {
        lineCount: lineCount,
        totalHeight: lineCount * tkLineHeight,
        totalCol: acc,
        colPerBlank: colPerBlank,
        lastLineOffset: offset
    };
}

//生成简答题HTML
AnswerSheet.prototype.generateShortHTML = function(data,isSub){
    //padding的高度
    var jdPaddingHeight = 20;
    //每行高度 height
    var jdLineHeight = 36;
    //多少行
    var lineCount = 0;
    var str = '',noBorderFlag;
    var maxLineCount = Math.floor((bodyHeight - jdPaddingHeight) / jdLineHeight);
    var totolHight = 0;

    //数学／化学／生物／物理的“简答题结构” 区域为空白，默认6行
    if(data.subject_id == 1 || data.subject_id == 2 || data.subject_id == 3 || data.subject_id == 4){
        noBorderFlag = true;
        lineCount = 6;
    }else{
        //如果答案大于48个汉字（96个字母），根据一行16个汉字（32个字母）相应的增加行数
        lineCount = Math.min(maxLineCount,3 + Math.max(0,Math.ceil((util.getWithTagLength(data.question_answer_list) - 96) / 32)));
    }
    totolHight = lineCount * jdLineHeight + jdPaddingHeight;
    this.checkPageBreak(totolHight,isSub);
    if(isSub){
        this.subIndex++;
    }else{
        this.tiIndex++;
    }
    str += '<ul class="jianda clearfix">';
    str += '<li><span class="short-no no">' + (isSub ? '(' + this.subIndex + ')' : this.tiIndex + '.') + '</span><div class="jd">';
    str += '<img src="'+ltSrc+'"  class="corner-l-t" alt=""><img src="'+rtSrc+'"  class="corner-r-t" alt="">';
    str += '<img src="'+lbSrc+'"  class="corner-l-b" alt=""><img src="'+rbSrc+'"  class="corner-r-b" alt="">';
    for (var i = 0; i < lineCount; i++) {
        str += '<div class="line ' + (noBorderFlag ? ' no-border' : '') + '"></div>';
    }
    str += '</div></li></ul>';
    this.htmlPerPage += str;
    this.setQrcodeData(isSub,0,this.accHeight - totolHight);
}

//生成判断题HTML
AnswerSheet.prototype.generateJudgeHTML = function(data,isSub){
    if(!Array.isArray(data)){
        data = [data];
    }
    var str = '';
    //一行5个
    var accCol = 0;
    //每行高度 height + margin
    var pdLineHeight = 40;

    for (var i = 0,len = data.length; i < len; i++) {
        accCol += 1;
        if(i == 0 || accCol > 5){
            accCol = 1;
            if(this.checkPageBreak(pdLineHeight,isSub,str && '<ul class="col-wrapper clearfix">' + str + '</ul>')){
                str = '';
            }
        }
        if(isSub){
            this.subIndex++;
        }else{
            this.tiIndex++;
        }
        str += this.generateChoiceTemplate('pd',1,isSub ? '(' + this.subIndex + ')' : this.tiIndex + '.');
        this.setQrcodeData(isSub,(contentWidth * (accCol - 1) / 5) >> 0,this.accHeight - pdLineHeight);
    }
    str = '<ul class="col-wrapper clearfix">' + str + '</ul>';
    this.htmlPerPage += str;
}

//下载pdf
AnswerSheet.prototype.download = function(){
    var obj = html2pdf().from(this.element).set({
        filename: this.data.taskName + '_' + this.data.name + '_答题卡.pdf',
        html2canvas: { scale: 2 },
        jsPDF: {
            orientation: 'portrait',
            unit: 'in',
            format: 'a4'
        }
    });
    if(this.downloadType == 1){
        obj.save().then(() => {
            console.log('done------');
            this.dtd.resolve('download success');
            this.element.parentNode.removeChild(this.element);
        });
    }else if(this.downloadType == 2){
        obj.output('blob').then((blob) => {
            console.log('done------');
            this.dtd.resolve(blob);
            this.element.parentNode.removeChild(this.element);
        })
    }

}

window.print = {
    init: function (info,downloadType) {
        var dtd = $.Deferred();
        var answerSheet = new AnswerSheet(info,dtd,downloadType);
        answerSheet.init();
        return dtd;
    }
}
